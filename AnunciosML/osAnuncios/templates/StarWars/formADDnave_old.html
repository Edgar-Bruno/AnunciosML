{% extends "baseNave.html" %}

{% load staticfiles %}

{% load templateTagUtils %}

{% block big_wrapper %}

	<div class="row">
								
		<div class="col-md-6 col-sm-offset-2">

			<form method="{{ method }}" action="{{ action }}" enctype="multipart/form-data"> {% csrf_token %}
				<table id="tableForms" cellpadding="0" cellspacing="0" width="100%" border="1">
					<caption></caption>
					<thead>
			    		<tr><th colspan="6" rowspan="1">{{ titulo }}</th></tr>
			    	</thead>
			    	<tbody>
			    		<tr>
			    			<td colspan="3">{{ form.naveNome.label }}</td>
			    			<td colspan="3" rowspan="19" class="tbCentrelizaDIV" >
			    				<div class="areaDiv" id="{{ formFosTa.banner.auto_id }}_DIV">
			    					{{ formFosTa.banner }}
			    					<div class="inserirTXT">
			    						{% if addEdit == False %}
			    							<p id="{{ formFosTa.banner.auto_id }}_LAB" >Insera uma imagem para o banner
			    								<p id="erroForm">{{ formFosTa.banner.errors.as_text }} </p>
			    							</p>
			    							<img id="{{ formFosTa.banner.auto_id }}_IMG" class="thumb" src="" style="visibility:hidden">
			    						{% else %}
			    							<img id="{{ formFosTa.banner.auto_id }}_IMG" class="thumb" src="{{ objI.banner.url }}">	
			    						{% endif %}			
   									</div>
			    				</div>	
			    				<br />{{ formFosTa.banner.label }}
			    			</td>
			    		</tr>
						<tr>
			    			<td colspan="3">
			    				<p id="erroForm">{{ form.naveNome.errors.as_text }}</p>
			    				{{ form.naveNome }}
			    			</td>
			    		</tr>
			    		<tr>
			    			<td colspan="3">{{ formP.produzido.label }}</td>
			    		</tr>
			    		<tr>
			    			<td colspan="3">{{ formP.produzido }}</td>
			    		</tr>
			    		<tr>
			    			<td colspan="3">
			    				<a id="{{ form.poster.auto_id }}btn" class="trigger linkADD" href="#" data-element="#{{ form.poster.auto_id }}" onclick="slideToggle(this)">{{ form.poster.label }}
				    				<span class="content">

										<span class="content-title">
											<span id="{{ form.poster.auto_id }}btn_checkBox" title="Confirme a adição" class="content-title-qtd">
												<p id="checkBoxEl">{{ PosterForm.checkBox_poster }}</p>
											</span>
											Adicione um novo Poster
										</span>
										<span class="content-body">
											adcione um poster ainda não cadastrado
										</span> 	
									</span>
			    				</a>
			    			</td>
			    		</tr>
			    		<tr>
			    			<td colspan="3">
			    				<div id="{{ form.poster.auto_id }}" class="add_item" style="display:none;">
									<table id="tableForms" cellpadding="0" cellspacing="0" width="100%" border="1">
										<thead>
			    							<tr><th colspan="2">Insira um novo Poster</th></tr>
			    						</thead>
										<tbody>
											<tr>
												<td colspan="1" rowspan="2" class="tbCentrelizaDIV" valign="top">
													<div class="areaDiv" id="{{ PosterForm.posterIMG.auto_id }}_DIV">
			    										{{ PosterForm.posterIMG }}
			    										<div class="inserirTXT">
				    										<p id="{{ PosterForm.posterIMG.auto_id }}_LAB" >Insera uma imagem para o poster
				    											<p id="erroForm">{{ PosterForm.posterIMG.errors.as_text }}</p>
				    										</p>
				    										<img id="{{ PosterForm.posterIMG.auto_id }}_IMG" class="thumb" src="" style="visibility:hidden">				
   														</div>
			    									</div>
												</td>
											<tr>
												<td colspan="2">
													<p>{{ PosterForm.subtitulos.label }}</p>
													<p id="erroForm">{{ PosterForm.subtitulos.errors.as_text }}</p>
													<p>{{ PosterForm.subtitulos }}</p>
													
													<p> {{ PosterForm.lancamento.label }}</p>
													<p id="erroForm">{{ PosterForm.lancamento.errors.as_text }}</p>
													{{ PosterForm.lancamento }}
												</td>
											</tr>
											<tr>
												<td colspan="2">
													{{ PosterForm.detalhe.label }}
													<p id="erroForm">{{ PosterForm.detalhe.errors.as_text }}</p>
													{{ PosterForm.detalhe }}
												</td>
											</tr>
										</tbody>
									</table>
								</div>

								<div id="{{ form.poster.auto_id }}btn_default" >
									<p id="erroForm">{{ form.poster.errors.as_text }} </p>
									{{ form.poster }}
								</div>
			    			</td>
			    		</tr>
			    		<tr>
			    			<td colspan="3">
			    				<a id="{{ form.afiliacao.auto_id }}btn" class="trigger linkADD" href="#" data-element="#{{ form.afiliacao.auto_id }}" onclick="slideToggle(this)">{{ form.afiliacao.label }}
				    				<span class="content">

										<span class="content-title">
											<span id="{{ form.afiliacao.auto_id }}btn_checkBox" title="Confirme a adição" class="content-title-qtd">
												<p id="checkBoxEl">{{ AfiliacaoForm.checkBox_afiliacao }}</p>
											</span>
											Adicione uma nova Afiliação
										</span>
										<span class="content-body">
											adcione uma afiliação ainda não cadastrada
										</span> 	
									</span>
			    				</a>
			    			</td>
			    		</tr>
			    		<tr>
			    			<td colspan="3">

			    				<div id="{{ form.afiliacao.auto_id }}" class="add_item" style="display:none;">

									<table id="tableForms" cellpadding="0" cellspacing="0" width="100%" border="1">
										<thead>
			    							<tr><th>Insira uma nova Afiliação</th></tr>
			    						</thead>
										<tbody>
											<tr>
												<td class="tbCentrelizaDIV" valign="top">
													<div class="areaDiv" id="{{ AfiliacaoForm.fotoAF.auto_id }}_DIV">
			    										{{ AfiliacaoForm.fotoAF }}
			    										<div class="inserirTXT">
				    										<p id="{{ AfiliacaoForm.fotoAF.auto_id }}_LAB" >Insera uma imagem para a afiliação
				    											<p id="erroForm">{{ AfiliacaoForm.fotoAF.errors.as_text }} </p>
				    										</p>
				    										<img id="{{ AfiliacaoForm.fotoAF.auto_id }}_IMG" class="thumb" src="" style="visibility:hidden">				
   														</div>
			    									</div>
			    									<br />{{ AfiliacaoForm.afiliacao.label }}
			    									<p id="erroForm">{{ AfiliacaoForm.afiliacaoADD.errors.as_text }} </p>
				    								<p >{{ AfiliacaoForm.afiliacaoADD }}</p>
												</td>
											</tr>

										</tbody>
									</table>

								</div>

								<div id="{{ form.afiliacao.auto_id }}btn_default" >
									<p id="erroForm">{{ form.afiliacao.errors.as_text }} </p>
									{{ form.afiliacao }}
								</div>
											
			    			</td>
			    		</tr>
			    		<tr>
			    			<td colspan="3">
			    				<a id="{{ form.cores.auto_id }}btn" class="trigger linkADD" href="#" data-element="#{{ form.cores.auto_id }}" onclick="slideToggle(this)">{{ form.cores.label }}
				    				<span class="content">

										<span class="content-title">
											<span id="{{ form.cores.auto_id }}btn_checkBox" title="Confirme a adição" class="content-title-qtd">
												<p id="checkBoxEl">{{ CoresForm.checkBox_cores }}</p>
											</span>
											Adicione uma nova cor
										</span>
										<span class="content-body">
											adcione uma cor ainda não cadastrada
										</span> 	
									</span>
			    				</a>

			    			</td>
			    		</tr>
			    		<tr>
			    			<td colspan="3">

			    				<div id="{{ form.cores.auto_id }}" class="add_item" style="display:none;">

									<table id="tableForms" cellpadding="0" cellspacing="0" width="100%" border="1">
										<thead>
			    							<tr><th>Insira uma nova Cor</th></tr>
			    						</thead>
										<tbody>
											<tr>
												<td class="tbCentrelizaDIV" valign="top">
				    								<p>	{{ CoresForm.coresNom.label }} </p>
			    									<p id="erroForm">{{ CoresForm.coresNom.errors.as_text }} </p>
				    								<p title="{{ CoresForm.coresHex.label }}">{{ CoresForm.coresHex }} {{ CoresForm.coresNom }}</p>
												</td>
											</tr>

										</tbody>
									</table>

								</div>

								<div id="{{ form.cores.auto_id }}btn_default" >
									<p id="erroForm">{{ form.cores.errors.as_text }} </p>
									{{ form.cores }}
								</div>

			    			</td>
			    		</tr>
			    		<tr>
			    			<th colspan="3" rowspan="1">Caracteristica do item</th>
			    		</tr>
			    		<tr>
			    			<td colspan="3">{{ formI.dimecoes.label }}</td>
			    		</tr>
			    		<tr>
			    			<td colspan="3">{{ formI.dimecoes }}</td>
			    		</tr>
			    		<tr>
			    			<td colspan="3">{{ formI.revista.label }}</td>
			    		</tr>
			    		<tr>
			    			<td colspan="3">{{ formI.revista }}</td>
			    		</tr>
			    		<tr>
			    			<td colspan="3">{{ formI.fasciculo.label }}</td>
			    		</tr>
			    		<tr>
			    			<td colspan="3">{{ formI.fasciculo }}</td>
			    		</tr>
			    		<tr>
			    			<td colspan="3">{{ formI.extras.label }}</td>
			    		</tr>
			    		<tr>
			    			<td colspan="3">{{ formI.extras }}</td>
			    		</tr>
			    		<tr>
			    			<th colspan="6" rowspan="1">Imagens extras</th>
			    		</tr>
			    		<tr>
			    			<td colspan="2" class="tbCentrelizaDIV" valign="top">
			    				<div class="areaDiv" id="{{ formFosTa.fotoCE.auto_id }}_DIV">
			    					{{ formFosTa.fotoCE }}
			    					<div class="inserirTXT">
			    						{% if addEdit == False %}
				    						<p id="{{ formFosTa.fotoCE.auto_id }}_LAB" >Insera uma cena do filme
				    							<p id="erroForm">{{ formFosTa.fotoCE.errors.as_text }} </p>
				    						</p>
				    						
				    						<img id="{{ formFosTa.fotoCE.auto_id }}_IMG" class="thumb" src="" style="visibility:hidden">
			    						{% else %}
			    							<img id="{{ formFosTa.fotoCE.auto_id }}_IMG" class="thumb" src="{{ objI.fotoCE.url }}">	
			    						{% endif %}		
   									</div>
			    				</div>	
			    				<br />{{ formFosTa.fotoCE.label }}		    			
			    			</td>
			    			<td colspan="2"  class="tbCentrelizaDIV" valign="top">
			    				<div class="areaDiv" id="{{ formFosTa.piloto.auto_id }}_DIV">
			    					{{ formFosTa.piloto }}
			    					<div class="inserirTXT" >
			    						{% if addEdit == False %}
				    						<p id="{{ formFosTa.piloto.auto_id }}_LAB" >Insera a foto do piloto
				    							<p id="erroForm">{{ formFosTa.piloto.errors.as_text }} </p>
				    						</p>
			    						
			    							<img id="{{ formFosTa.piloto.auto_id }}_IMG" class="thumb" src="" style="visibility:hidden">
			    						{% else %}
			    							<img id="{{ formFosTa.piloto.auto_id }}_IMG" class="thumb" src="{{ objI.piloto.url }}">	
			    						{% endif %}			
   									</div>
			    				</div>
				    			<br />{{ form.nomepiloto.label }}
				    			<p>{{ form.nomepiloto }}</p>
			    			</td>
			    			<td colspan="2" class="tbCentrelizaDIV" valign="top">
			    				<div class="areaDiv" id="{{ formFosTa.fotoMo.auto_id }}_DIV">
			    					{{ formFosTa.fotoMo }}
			    					<div class="inserirTXT">
			    						{% if addEdit == False %}
				    						<p id="{{ formFosTa.fotoMo.auto_id }}_LAB" >Insera uma imagem de modelo
				    							<p id="erroForm">{{ formFosTa.fotoMo.errors.as_text }} </p>
				    						</p>
				    						
				    						<img id="{{ formFosTa.fotoMo.auto_id }}_IMG" class="thumb" src="" style="visibility:hidden">		
			    						{% else %}
			    							<img id="{{ formFosTa.fotoMo.auto_id }}_IMG" class="thumb" src="{{ objI.fotoMo.url }}">	
			    						{% endif %}				
   									</div>
			    				</div>
			    				<br />{{ formFosTa.fotoMo.label }}	
			    			</td>
			    		</tr>
			    		<tr>
			    			<th colspan="6" rowspan="1">Fotos do produto anunciado</th>
			    		</tr>
			    		<tr>
			    			<td colspan="6" class="tbCentrelizaDIV" valign="center">


			    				<div class="areaDiv" id="{{ formF.fotoAN.auto_id }}_DIV">
			    					{{ formF.fotoAN }}
			    					<div class="inserirTXT">
			    						<p id="{{ formF.fotoAN.auto_id }}_LAB" >Insera as fotos do anúncio</p>
			    						<img id="{{ formF.fotoAN.auto_id }}_IMG" class="thumb" src="" style="visibility:hidden">				
   									</div>
			    				</div>
			    					{% if addEdit %}
			    						<p>{{ formF.checkBox_fotosAnuncios }} {{ formF.checkBox_fotosAnuncios.label }}</p>
				    					{% for img in objF %}
				    						<img class="thumbF thumbOpac" title="{{ img.fotoAN }}" src="{{ img.fotoAN.url }}" >
				    					{% endfor %}
				    					<hr>
			    					{% endif %}
			    					<output id="list"></output>
			    			</td>
			    		</tr>
			    		<tr>
			    			<th colspan="6" rowspan="1">Caracteristicas e informações da nave</th>
			    		</tr>
			    		<tr>
			    			<td colspan="3" rowspan="1">
			    				<a id="{{ form.fabricante.auto_id }}btn" class="trigger linkADD" href="#" data-element="#{{ form.fabricante.auto_id }}" onclick="slideToggle(this)">{{ form.fabricante.label }}
				    				<span class="content">

										<span class="content-title">
											<span id="{{ form.fabricante.auto_id }}btn_checkBox" title="Confirme a adição" class="content-title-qtd">
												<p id="checkBoxEl">{{ FabricanteForm.checkBox_fabricante }}</p>
											</span>
											Adicione um novo fabricante
										</span>
										<span class="content-body">
											adcione um fabricante ainda não cadastrado
										</span> 	
									</span>
			    				</a>

			    			</td>
			    			<td colspan="3" rowspan="1">
			    				<div id="{{ form.fabricante.auto_id }}" class="add_item" style="display:none;">

									<table id="tableForms" cellpadding="0" cellspacing="0" width="100%" border="1">
										<thead>
			    							<tr><th>Insira um novo Fabricante</th></tr>
			    						</thead>
										<tbody>
											<tr>
												<td class="tbCentrelizaDIV" valign="top">
			    									<p id="erroForm">{{ FabricanteForm.fabricanteADD.errors.as_text }} </p>
			    									<p>{{ FabricanteForm.fabricante.label }}  {{ FabricanteForm.fabricanteADD }} </p>
												</td>
											</tr>

										</tbody>
									</table>

								</div>

								<div id="{{ form.fabricante.auto_id }}btn_default" >
									<p id="erroForm">{{ form.fabricante.errors.as_text }} </p>
									{{ form.fabricante }}
								</div>

			    			</td>
			    		</tr>
			    		<!-- SOLUÇÃO ENCOTRADA EM
			    		https://djangosnippets.org/snippets/1246/
			    		-->
			    		{% for f in formset.management_form %}
			    			{{ f }}

			    		{% endfor %}

			    		{% for f in formset.forms %}
			    			<!-- SOLUÇÃO ENCOTRADA EM
							http://stackoverflow.com/questions/13666852/how-to-debug-a-django-multivaluedictkeyerror-on-formset-post
			    			-->
			    			{% for hidden in f.hidden_fields %}
								        {{ hidden }}
						    {% endfor %}
			    			
				    		<tr class="item">
				    			{% for field in f %}

				    				{% if forloop.counter0 == 0 %}

						    			<td  colspan="3">
				    				
				    				{% endif %}
				    				
						    		{% if field.name == 'informacao' %}
						    			</td>
						    			<td  colspan="3">
						    				{{ field.label_tag }}<br/>
						    				{{ field }}
						    		{% endif %}

						    		{% if field.name == 'caracteristica' %}

								    	<a id="{{ field.auto_id }}btn" class="trigger linkADD" href="#" data-element="#{{ field.auto_id }}" onclick="slideToggle(this)">{{ field.label }}
						    				<span class="content">

												<span class="content-title">
													<span id="{{ field.auto_id }}btn_checkBox" title="Confirme a adição" class="content-title-qtd">
														<p id="checkBoxEl">
											    			{% with f|fieldCAT:'checkBox_descricao' as fieldCAT %}
											    		
											    				{{ fieldCAT }}
											    			
											    			{% endwith %}
														</p>
													</span>
													
													Adicione uma nova Caracteristica

												</span>
												<span class="content-body">
													adcione uma caracteristica ainda não cadastrada
												</span> 	
											</span>
					    				</a>

					    				<br />
					    				<div id="{{ field.auto_id }}" class="add_item" style="display:none;">

											<table id="tableForms" cellpadding="0" cellspacing="0" width="100%" border="1">
												<thead>
					    							<tr><th>Insira uma nova Caracteristica</th></tr>
					    						</thead>
												<tbody>
													<tr>
														<td class="tbCentrelizaDIV" valign="top">
					    									<p id="erroForm">{{ field.errors.as_text }} </p>
					    									<p>{{ field.label }}
						    									{% with f|fieldCAT:'caracteristicaADD' as fieldCAT %}
												    		
												    				{{ fieldCAT }}
												    			
												    			{% endwith %}
					    									</p>
														</td>
													</tr>

												</tbody>
											</table>

										</div>

										<div id="{{ field.auto_id }}btn_default" >
											<p id="erroForm">{{ field.errors.as_text }} </p>
											{{ field }}
										</div>

											<p style="visibility:hidden">
												<a id="remove" class="delete" href="#">Delete</a>
											</p>

						    		{% endif %}
	
				    			{% endfor %}
				    			</td>
				    		</tr>
				    		<tr>				    		
				    			<td colspan="6">
				    				<p><a id="add" href="#">Add detalhe</a></p>
				    			</td>

				    		</tr>
				    			
				    	{% endfor %}
		
			    	</tbody>
		
				</table>

				<hr>

				<br />
				<input class="btn {{ Options }} btn-lg col-md-4 col-md-offset-3" type="submit" value="{{ botao }}">

			</form>

		</div>

		<div class="col-sm-4">
			<table id="tableDetalhe">
				<caption>Informativo vendas e estoque</caption>
				<thead>
			    	<tr><th colspan="4">Vendas</th></tr>
			    </thead>
			    <tbody>
			    	<tr>
			    		<td>ESTOQUE</td>
			    		<td>VENDA</td>
			    		<td>VENDA %</td>
			    		<td>SALDO</td>

			    	</tr>
			    	<tr>
			    		<td>{{ objVEN.0 }}</td>
			    		<td>{{ objVEN.1.totalVenda }}</td>
			    		<td>{{ objVEN.2 }}</td>
			    		<td>{{ objVEN.1.totalValor }}</td>
			    	</tr>
			    </tbody>
			</table>

			<hr>
			<!--
			<div id="modalJanela" style="display:none;">
				<iframe id="modalJanela_I" src="" frameBorder="0" width=100% height=95%></iframe>
			</div>
			-->

			<output id="modalDiv"></output>

			{% for obj in objRAW %}

				{% if objRAW|proximo:forloop.counter0 == 2 %}<!-- DIV FECHAR -->
					<hr>
					</div>
				{% endif %}

				{% if objRAW|proximo:forloop.counter0 %}<!-- DIV CRIAR -->
					<br />

					{{ obj.afiliacao }}

					<br />
					<!-- Cria o link e tooltip -->
					{% with objRAW|tooltipM:forloop.counter0 as objT %}

					<a id="{{ forloop.counter0 }}btn" class="trigger btn btn-primary btn-sm" data-element="#{{ obj.afiliacao|espacoReplace }}" onclick="slideToggle(this)">Mostrar

						<span class="content">

							<span class="content-title">Total de naves  
								<span class="content-title-qtd">
									{{ objT|length }}
								</span>
							 	
							 </span>
							 <span id="imgTooltipAfiliContent">
							 	<img id="imgTooltipAfili" src="{{ obj.afiliacao.fotoAF.url }}"/>
							 </span>
							{% for val in objT %}
								<span class="content-body">
									{% for imgF in val.imagensN.all %}
										<img class="image_tooltip" height="40" src="{{ imgF.banner.url }}"/>
									{% endfor %}
									<span class="content-txt">
										{{ val }}
									</span>

								</span>

							{% endfor %}
					
						</span>
					</a>

					{% endwith %}

					<div id="{{ obj.afiliacao|espacoReplace }}" style="display:none;">
				
				{% endif %}



				<table id="tableDetalhe">
				  <caption>{{ obj.afiliacao }}</caption>
				  <thead>
				    <tr><th colspan="4">{{ obj }}</th></tr>
				  </thead>
				  <tfoot>
				    <tr><td colspan="4">
				    	{% with 'Editar Estoque Venda' as prefix %}

							{% for var in prefix.split %}	
								{% with URL_l=var|add:"_"|add:linkULR %}
									<li>
										{% if forloop.counter0 == 0 %}

										<a class="btn btn-primary btn-sm"  href="{% url URL_l obj.get_naveNome %}" role="button">{{ var }}</a>

										{% else %}
											<a id="{{ obj|espacoReplace }}" class="btn btn-primary btn-sm" onclick="Modal('{{ var }}', '{{ obj }}', '{% url URL_l obj|espacoReplace %}')" href="#" role="button">{{ var }}</a>
										{% endif  %}
									</li>
								{% endwith %}
							{% endfor %}

						{% endwith %}
				    </td></tr>
				  </tfoot>
				  <tbody>
				    <tr>
				      <td rowspan="2">
				      		<a href="{% url 'Exibir_nave' obj.get_naveNome %}">
				      			{% for imgF in obj.imagensN.all %}
				      				<img title="{{ obj }}" class="image_link" border="1" height="75" src="{{ imgF.banner.url }}"/>
				      			{% endfor %}
				      		</a>
				      </td>
				      <td>Estoque</td>
				      <td>Vendas</td>
				      <td>Margem</td>
				    </tr>
				    <tr>
				      <td> {% if obj.estoqAtual %}
				      			{{ obj.estoqAtual }}
				      	   {% else %}
				      	   		-
				      	   {% endif %}
				      </td>
				      <td> {% if obj.vendasTotal %}
				      			{{ obj.vendasTotal }}
				      	   {% else %}
				      	   		-
				      	   {% endif %}
				      </td>
				      <!-- Custom tag: retorna percentagem de lucro de cada venda -->
				      {% with args=obj.vendasTotal|stringformat:"i"|add:" "|add:obj.valorVendasTotal %}
				      <td>
					      {% if obj.vendasTotal %}
					     	 {{ obj.valorUni|margemLucro:args }}
					      {% else %}
					      -		 
					      {% endif %}
					  </td>
				      {% endwith %}
				    </tr>
				  </tbody>
				</table>

				{% if forloop.last %}<!-- FECHAMENDO DA DIV DO ÚLTIMO ITEM ABERTA -->
					</div>
				{% endif %}

			{% endfor %}

		</div>
	</div><!-- DIV ROW -->
{% endblock big_wrapper %}